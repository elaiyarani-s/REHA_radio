<div id="chat-messages" class="p-3 border rounded shadow-sm mb-3 bg-body-secondary"
     style="height: 400px; overflow-y: auto;">
  <!-- Chat messages will be injected here via JavaScript -->
</div>

<form id="chat-form" method="post" class="input-group">
  {% csrf_token %}
  <input type="text" name="content" id="message-input" class="form-control" placeholder="Type your message..." required>
  <button type="submit" class="btn btn-primary">Send</button>
</form>

<script>
  const chatBox = document.getElementById('chat-messages');
  const chatForm = document.getElementById('chat-form');
  const input = document.getElementById('message-input');

  // Streaming messages
  const eventSource = new EventSource("{% url 'stream_chat' %}");
  eventSource.onmessage = function (e) {
    const data = JSON.parse(e.data);
    const messageHTML = `<div><strong>${data.author__name}:</strong> ${data.content}</div>`;
    chatBox.innerHTML += messageHTML;
    chatBox.scrollTop = chatBox.scrollHeight;
  };

  // Sending messages
  chatForm.addEventListener('submit', function (e) {
    e.preventDefault();
    const formData = new FormData(chatForm);
    fetch("{% url 'create_message' %}", {
      method: "POST",
      headers: {
        'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
      },
      body: formData
    }).then(() => {
      input.value = '';
    });
  });
</script>
